CTRL='Control_L=Escape'
SHIFT='Shift_L=Multi_key;Shift_R=Multi_key'
ALT='Alt_L=F12;Alt_R=F12'
RETURN='Control_R=Return'
SPACE='Mode_switch=space'

function kinesis_connected {
  lsusb | grep "Kinesis Advantage" &> /dev/null
}

function start_xcape {
  run-this-one xcape -d -t 250 -e "$CTRL;$SHIFT;$ALT;$RETURN;$SPACE" &
}

function stop_xcape {
  killall xcape &> /dev/null || true
}

if [ kinesis_connected ]; then
  stop_xcape
else
  start_xcape
fi
