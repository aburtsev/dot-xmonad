CTRL='Control_L=Escape'
SHIFT='Shift_L=Multi_key;Shift_R=Multi_key'
ALT='Alt_L=F12;Alt_R=F12'
RETURN='Control_R=Return'
SPACE='Mode_switch=space'

function kinesis_connected {
  lsusb | grep "Kinesis Advantage" &> /dev/null
  return $?
}

function start_xcape {
  local mappings=$1
  run-this-one xcape -d -t 250 -e "$mappings" &
}

function stop_xcape {
  killall xcape &> /dev/null || true
}

kinesis_connected
if [ $? -eq 0 ]; then
  start_xcape "$CTRL;$ALT"
else
  start_xcape "$CTRL;$SHIFT;$ALT;$RETURN;$SPACE"
fi
