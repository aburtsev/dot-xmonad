CTRL='Control_L=Escape'
CTRL_R='Control_R=Escape'
ALT='Alt_L=F12;Alt_R=F12'
RETURN='Control_R=Return'

function kinesis_connected {
  lsusb | grep "Kinesis Advantage" || true
}

function start_xcape {
  local mappings=$1
  run-this-one xcape -d -t 250 -e "$mappings" &
}

function stop_xcape {
  killall xcape &> /dev/null || true
}

if [ -n "$(kinesis_connected)" ]; then
  start_xcape "$CTRL;$CTRL_R;$ALT"
else
  start_xcape "$CTRL;$ALT;$RETURN"
fi
